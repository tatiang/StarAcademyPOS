/* FILE: js/main_test_Gemini.js
   PURPOSE: Main entry point. Handles navigation and startup.
*/

// CHANGED: Renamed from 'app.main' to 'app.router' to match HTML onclick events
window.app.router = {
    
    init: function() {
        console.log("System Boot: " + window.app.version);
        
        // 1. Initialize Database & Load Data
        window.app.database.init(() => {
            // 2. Render Sidebar Version
            const verEl = document.getElementById('app-version');
            if(verEl) verEl.innerText = window.app.version;

            // 3. Start Default View (POS)
            this.navigate('pos'); 
        });
    },

    // NAVIGATION LOGIC
    // CHANGED: Renamed from 'switchView' to 'navigate' to match HTML
    navigate: function(viewName) {
        
        // A. Hide all views
        document.querySelectorAll('.app-view').forEach(el => el.style.display = 'none');
        
        // B. Update Sidebar Buttons
        // CHANGED: targeting '.nav-links li' instead of '.nav-btn'
        document.querySelectorAll('.nav-links li').forEach(btn => btn.classList.remove('active'));
        
        // CHANGED: looking for 'nav-' ID instead of 'btn-'
        const activeBtn = document.getElementById(`nav-${viewName}`);
        if(activeBtn) activeBtn.classList.add('active');

        // C. Show Selected View & Initialize Module
        const viewId = `view-${viewName}`;
        const viewEl = document.getElementById(viewId);
        
        if(viewEl) {
            viewEl.style.display = 'block';
            
            // --- MODULE ROUTER ---
            // This triggers the specific logic for each screen
            if(viewName === 'pos') {
                if(window.app.posScreen) window.app.posScreen.init(); // Note: sometimes named pos or posScreen
                else if(window.app.pos) window.app.pos.init();
            }
            else if(viewName === 'barista') {
                if(window.app.barista) window.app.barista.init();
            }
            else if(viewName === 'manager') {
                if(window.app.managerHub) window.app.managerHub.init();
            }
            else if(viewName === 'it') {
                if(window.app.itHub) window.app.itHub.render();
            }
            else if(viewName === 'inventory') {
                if(window.app.inventory) window.app.inventory.init();
            }
            else if(viewName === 'timeclock') {
                 if(window.app.timeclock) window.app.timeclock.init();
            }
            else if(viewName === 'dashboard') {
                 if(window.app.dashboard) window.app.dashboard.init();
            }

        } else {
            console.error("View container not found: " + viewId);
        }
    }
};

// Start the App when page loads
window.onload = function() {
    window.app.router.init();
};
